#!/bin/bash

# Define variables for the certificate details
COUNTRY="US"
STATE="California"
LOCALITY="San Francisco"
ORGANIZATION="My Company"
ORGANIZATIONAL_UNIT="My Department"
COMMON_NAME="localhost"
DAYS=365

# Create a configuration file for OpenSSL
cat <<EOF > openssl.cnf
[req]
distinguished_name = req_distinguished_name
x509_extensions = v3_req
prompt = no

[req_distinguished_name]
C = $COUNTRY
ST = $STATE
L = $LOCALITY
O = $ORGANIZATION
OU = $ORGANIZATIONAL_UNIT
CN = $COMMON_NAME

[v3_req]
keyUsage = keyEncipherment, dataEncipherment
extendedKeyUsage = serverAuth
subjectAltName = @alt_names

[alt_names]
DNS.1 = $COMMON_NAME
EOF

# Generate the server private key and certificate
openssl genrsa -out server.key 2048
openssl req -new -key server.key -out server.csr -config openssl.cnf
openssl x509 -req -in server.csr -signkey server.key -out server.crt -days $DAYS -extensions v3_req -extfile openssl.cnf

# Generate the client private key and certificate
openssl genrsa -out client.key 2048
openssl req -new -key client.key -out client.csr -config openssl.cnf
openssl x509 -req -in client.csr -signkey client.key -out client.crt -days $DAYS -extensions v3_req -extfile openssl.cnf

# Clean up
rm server.csr client.csr openssl.cnf

echo "Certificates generated successfully:"
echo "  - server.key"
echo "  - server.crt"
echo "  - client.key"
echo "  - client.crt"
